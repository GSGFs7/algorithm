//#include <bits/stdc++.h>
#include <cstdio>
using namespace std;

/*
 * å¹¶æŸ¥é›†
 * å¸¦æƒå¹¶æŸ¥é›†
 *
 * é£Ÿç‰©é“¾ï¼Œç¯å½¢ç»“æ„ï¼Œç”¨è·ç¦»è¡¨ç¤ºçš„è¯çœ‹æ¨¡3ä½™å‡ å°±èƒ½å¤Ÿè¡¨ç¤ºä¸¤ä¸ªç”Ÿç‰©é—´çš„ä¸‰ç§çŠ¶æ€
 * åœ¨è·¯å¾„å‹ç¼©æ—¶é¡ºå¸¦å¤„ç†æ¯æ¡è¾¹çš„æƒå€¼ï¼Œéœ€è¦é€’å½’æ±‚è§£
 * */

const int N = 50010;
int p[N], d[N];

int find(int x)
{
    if (x != p[x]) {// å¦‚æœè¿˜æ²¡æœåˆ°ç¥–å®—èŠ‚ç‚¹
        int const t = find(p[x]);// è®°å½•ä¸‹æ¥ç¥–å®—èŠ‚ç‚¹
        d[x] += d[p[x]];// çˆ¶èŠ‚ç‚¹åˆ°ç¥–å®—èŠ‚ç‚¹çš„è·ç¦»åŠ ä¸Šè¿™ä¸ªç‚¹åˆ°çˆ¶èŠ‚ç‚¹çš„è·ç¦»
        // é€’å½’è°ƒç”¨ï¼Œç›´åˆ°å¾—åˆ°æœ€åçš„ç»“æœï¼Œæ‰€ä»¥å½“ç¨‹åºæ‰§è¡Œåˆ°è¿™ä¸€æ­¥æ—¶ï¼Œçˆ¶èŠ‚ç‚¹åˆ°ç¥–å®—èŠ‚ç‚¹çš„è·ç¦»ä¹Ÿå·²ç»æ±‚å‡ºæ¥äº†
        // éœ€è¦å…ˆé€’å½’å¾—åˆ°ä»ç¥–å®—èŠ‚ç‚¹å¼€å§‹çš„ç­”æ¡ˆæ‰èƒ½ç»§ç»­ï¼Œæ‰€ä»¥è¦å…ˆé€’å½’å†èµ‹å€¼
        p[x] = t;// èµ‹å€¼ä¸ºç¥–å®—èŠ‚ç‚¹
    }
    return p[x];
}

int main()
{
#ifdef __LOCAL__
    freopen("1.in", "r", stdin);
    freopen("1.out", "w", stdout);
#endif

    int n, m;
    scanf("%d%d", &n, &m);

    for (int i = 1; i <= n; i++) p[i] = i;// åˆå§‹åŒ–ï¼Œæ¯ä¸ªå€¼çš„ç¥–å®—èŠ‚ç‚¹éƒ½æ˜¯è‡ªå·±

    int ans = 0;
    while (m--)
    {
        int op, x, y;
        scanf("%d%d%d", &op, &x, &y);// deäº†å¥½ä¹…ç»“æœå‘ç°æ ¹æœ¬æ²¡æœ‰è¯»å…¥
        if (x > n || y > n) { ans ++; continue; }

        int const px = find(x), py = find(y);// ä¸¤ä¸ªç‚¹çš„ç¥–å®—èŠ‚ç‚¹
        if (op == 1)// åŒç±»
        {
            if (px == py)
            {
                if ((d[x] - d[y]) % 3) ans ++;// d[x]ä¸d[y]å¯èƒ½æ˜¯æ­£æ•°ä¹Ÿå¯èƒ½æ˜¯è´Ÿæ•°
            }
            else// è¦ä¸å±äºåŒä¸€ä¸ªé›†åˆæ‰å»ºç«‹è”ç³»
            {
                p[px] = py;// æ˜¯p[px]ç›´æ¥è¡¨ç¤ºç¥–å®—èŠ‚ç‚¹ï¼Œä¸ç„¶p[x]è¡¨ç¤ºçš„æ˜¯çˆ¶èŠ‚ç‚¹
                d[px] = d[y] - d[x];//
            }
        }
        else// å¤©æ•Œ
        {
            if (px == py)
            {
                if ((d[x] - d[y] - 1) % 3) ans ++;
            }
            else
            {
                p[px] = py;
                d[px] = d[y] - d[x] + 1;
            }
        }
    }
    printf("%d", ans);
    return 0;
}


// https://www.acwing.com/problem/content/242/
// http://poj.org/problem?id=1182                   // åœ¨pojä¼šTLEï¼ŒYæ€»ä»£ç è¿‡äº†ï¼Œæ˜¯scanfçš„åŸå› ğŸ˜ğŸ‘ŒğŸ˜­